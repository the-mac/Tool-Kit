<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,1:ImageSprite;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Content/Css:1&amp;amp;hashKey=E7560C71640616C5057FAEACB58DCB00" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/2f95808e-ca34-4249-88ff-44fabe33cdc0Combined.css,1:LinkList,2:ImageSprite,2:SiteFeedbackLink;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Themes/Base/Content:1,/Areas/Epx/Content/Css:2&amp;amp;hashKey=EEE39C2D6B93379FDAF50337BE99AF8C" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Using Local Storage with OData on Windows Phone To Reduce Network Bandwidth</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Using Local Storage with OData on Windows Phone To Reduce Network Bandwidth</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Windows Azure, T4 Template, OData, Windows Phone, Windows Phone Mango, Windows Phone SDK 7.1
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            OData, Phone application development, Building A Windows Phone MVVM App, local database on Windows Phone
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web, Cloud, Phone, Data
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary Language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Last Updated</label>
                    <div id="LastUpdated">7/6/2012</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Using-Local-Storage-with-366c4ee4">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy Code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div id="mainSection">
<div id="mainBody">
<div class="saveHistory" id="allHistory"></div>
<h1>Introduction</h1>
There are several reasons why storing a cache of OData object data on the device is a good idea:
<ol>
<li>Reduced amount of network traffic. This is the most important benefit to caching data locally. Otherwise, every time the app starts it has to hit the OData feed to load initial data, which is a huge waste of bandwidth for OData feeds that are relatively
 static. </li><li>Improved load time. It&rsquo;s much faster to load data from the device than to make an HTTP request to the OData service.
</li><li>App don&rsquo;t need network access to start. When the app is dependent on remote data, it can&rsquo;t really start well without a connection.
</li><li>Puts the user in control. Users can decide on if and when to sync the local data to the OData service, since most of them pay for their data.
</li><li>Reduced tombstoning serialization. When the entities are stored in local database, they can be retrieved from there, which means they don&rsquo;t need to be serialized and tombstoned.
</li></ol>
<p>Windows Phone 7.5 (&quot;Mango&quot;) includes a new local storage feature called <a href="http://msdn.microsoft.com/en-us/library/hh202860(v=VS.92).aspx">
<em>local database</em></a>. Local database is a LINQ-to-SQL implementation to access a local SQL Server CE instance running on the device. This storage provides an excellent way to persist our OData entities. You can read more about this in my blog series
<a href="http://blogs.msdn.com/b/writingdata_services/archive/tags/L2S/">Sync&rsquo;ing OData to Local Storage in Windows Phone</a>. This sample uses a T4 template to generate a proxy client needed to access both an OData service and local database on the device.</p>
<div>
<h1 class="heading"><span>Features</span></h1>
</div>
<div>
<div class="section" id="sectionSection1">
<p>This sample uses the following features of Windows Phone 7.5 and the OData client library in the 7.1 SDK.</p>
<ol class="ordered">
<li>Storing entities in local database </li><li>Storing images in isolated storage </li><li>T4 template for client code generation </li><li>Data binding&nbsp; </li><li>View-model programming pattern </li><li>Tombstoning </li><li>Client-requested paging </li><li>Support for server-side paging </li><li>Requesting the media resource stream </li></ol>
</div>
</div>
<div>
<h1 class="heading"><span>Prerequisites</span></h1>
<div class="section" id="sectionSection2">
<p>Before running this sample, make sure that the following software is installed:</p>
<ul>
<li>Visual Studio 2010 </li><li class="unordered"><a href="http://go.microsoft.com/fwlink/?LinkID=219822">Windows Phone SDK 7.1</a>
</li><li class="unordered"><a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=5B1A903E-59E2-46E8-B63B-A9421BBB6BF9&amp;displaylang=zh-tw&amp;displaylang=en#AffinityDownloads">Microsoft WCF Data Services 5.0 for OData v3</a>&nbsp;or later version from
 NuGet (needed by the T4 template) </li><li class="unordered">(Optional) <a href="http://code.msdn.microsoft.com/Using-Local-Storage-with-366c4ee4/https://nuget.org/packages/ODataT4-CS">
NuGet package ODataT4-CS</a> </li></ul>
</div>
</div>
<div>
<h1 class="heading"><span>Building and Running the Sample</span></h1>
<div class="section" id="sectionSection3">
<p>Use the following procedures to build and run the sample.</p>
<div>
<h3 class="subHeading"><span><strong>To update the reference and build the sample</strong></span></h3>
<div class="subSection">
<ol class="ordered">
<li>
<p>Unzip the sample files on the local computer.</p>
</li><li>
<p>In Visual Studio 2010, open the solution file ODataWinPhoneLocalStorage.sln.</p>
</li><li>
<p>Open the ReferenceWithLocalDatabase.tt template file and change the value of the
<br>
MetadataFilepath property in the TransformContext constructor to the location of <br>
the .edmx file generated by the service reference on your computer (T4 doesn't support relative paths or VS macros).</p>
</li><li>Build the project. </li></ol>
</div>
</div>
<div>
<h3 class="subHeading"><span><strong>To run the application</strong></span></h3>
<div class="subSection">
<ol class="ordered">
<li>
<p>Press F5.</p>
<p>This deploys the application to the Windows Phone emulator and runs the sample in debug mode.</p>
</li><li>
<p>Click the <strong>Next Page</strong> button to load the next client-requested page of results, click a title to see details about the title, or click the<strong>Back</strong> button to return to the previous page.</p>
</li><li>
<p>Click the <strong>Clear Cache</strong> button. This requests that the local storage be cleared the next time that the application starts.</p>
</li><li>
<p>Click the <strong>Start</strong> button.</p>
<p>This causes the application to deactivate and initiates tombstoning.</p>
</li><li>
<p>Click the <strong>Back</strong> button.</p>
<p>This causes the application to reactivate and application state is restored.</p>
</li></ol>
</div>
</div>
</div>
</div>
</div>
<h1>More Information</h1>
<ul>
<li><span><a href="http://msdn.microsoft.com/en-us/library/gg521146(v=VS.92).aspx">Open Data Protocol (OData) Overview for Windows Phone</a></span>
</li><li><span><span><a href="http://blogs.msdn.com/b/writingdata_services/archive/tags/L2S/">Sync&rsquo;ing OData to Local Storage in Windows Phone</a> (blog series)</span></span>
</li><li><span><span><a href="http://msdn.microsoft.com/en-us/library/gg521145(v=VS.92).aspx">How to: Consume an OData Service for Windows Phone</a></span></span>
</li><li><a id="ff967573_VS.92_en-us" title="Local Data Storage for Windows Phone" href="http://msdn.microsoft.com/en-us/library/ff626522(v=VS.92).aspx">Local Data Storage for Windows Phone</a>
</li><li><span><span><a href="http://www.odata.org">Open Data Protocol (OData) Web Site</a></span></span>
</li></ul>
<p>&nbsp;</p>
</div>

</div>


    </div>
</body>
</html>
