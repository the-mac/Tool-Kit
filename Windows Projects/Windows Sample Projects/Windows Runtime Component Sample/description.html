<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="description/Combined.css,1:ImageSprite;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Content/Css:1&amp;amp;hashKey=E7560C71640616C5057FAEACB58DCB00" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="description/2f95808e-ca34-4249-88ff-44fabe33cdc0Combined.css,1:LinkList,2:ImageSprite,2:SiteFeedbackLink;/Areas/Epx/Themes/Msdn/Content:0,/Areas/Epx/Themes/Base/Content:1,/Areas/Epx/Content/Css:2&amp;amp;hashKey=EEE39C2D6B93379FDAF50337BE99AF8C" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>Windows Runtime Component Sample</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="description/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="description/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>Windows Runtime Component Sample</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            Windows Phone 8
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            ICommand, windows runtime component, XAudio2, async-await
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Phone
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary Language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Last Updated</label>
                    <div id="LastUpdated">6/5/2013</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">MS-LPL</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="http://code.msdn.microsoft.com/Windows-Runtime-Component-fb644b34">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy Code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<div id="mainBody">
<p></p>
<div class="introduction">
<p>The sample demonstrates the basics of how to create a Windows Phone Runtime component and consume it in your Windows&nbsp;Phone&nbsp;8 app. A Windows Phone Runtime component is a Windows Runtime component that can run on the phone. The sample highlights three scenarios.
 The first scenario illustrates calling synchronous and asynchronous methods to perform a computation. The second scenario uses the same computation component to demonstrate progress reporting and cancelling long-running tasks. The third scenario demonstrates
 how to use a component to wrap logic that uses XAudio2 APIs to play a sound on the phone.
</p>
<p>This sample shows you how to:</p>
<ul>
<li>
<p>Create a Windows Runtime component.</p>
</li><li>
<p>Implement an asynchronous API in your component.</p>
</li><li>
<p>Implement progress and cancellation in your component.</p>
</li><li>
<p>Consume Windows Runtime components in your XAML app.</p>
</li></ul>
<p></p>
<p>For more info about the sample, see <span class="term">Sample description</span>.</p>
<div class="alert">
<table width="100%" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<th align="left"><b>Note:</b> </th>
</tr>
<tr>
<td>
<p>The terms <span class="term">Windows Runtime component</span> and <span class="term">
Windows Phone Runtime component</span> are used interchangeably throughout this document to refer to a Windows Runtime component that is created to use in a Windows&nbsp;Phone&nbsp;8 app.</p>
</td>
</tr>
</tbody>
</table>
</div>
<h3 class="procedureSubHeading">Build the sample</h3>
<div class="subSection">
<ol>
<li>
<p>Start Visual Studio Express 2012 for Windows&nbsp;Phone and select <span class="ui">
File</span> &gt; <span class="ui">Open</span> &gt; <span class="ui">Project/Solution</span>.</p>
</li><li>
<p>Go to the directory in which you unzipped the sample. Double-click the Visual Studio Express 2012 for Windows&nbsp;Phone solution (<span class="label">.sln</span>) file.</p>
</li><li>
<p>Use <span class="ui">Build</span> &gt; <span class="ui">Rebuild Solution</span> to build the sample.</p>
</li></ol>
</div>
<p></p>
<h3 class="procedureSubHeading">Run the sample</h3>
<div class="subSection">
<ul>
<li>
<p>To debug the app and then run it, press F5 or use <span class="ui">Debug</span> &gt;
<span class="ui">Start Debugging</span>. To run the app without debugging, press Ctrl&#43;F5 or use
<span class="ui">Debug</span> &gt; <span class="ui">Start Without Debugging</span>.</p>
</li></ul>
</div>
<p></p>
<p><b>Sample description</b> </p>
<p>This sample contains the following three projects.</p>
<ul class="nobullet">
<li>
<p><span class="label">PhoneApp.</span> This is the XAML phone app written in C# that consumes the Windows Runtime components built in this sample. It consists of a Panorama page, on which each scenario is displayed using a separate
<span value="PanoramaItem"><span class="keyword">PanoramaItem</span></span>.</p>
</li><li>
<p><span class="label">ComputeComponent_Phone.</span> This is a Windows Runtime component written in C&#43;&#43;. The component exposes methods for performing some computations – one method adds two numbers, and another finds all prime numbers in a range. The actual
 computations are for illustration purposes only, to demonstrate the power of using Windows Phone Runtime components. The component was created in the solution by selecting
<span class="ui">File</span> &gt; <span class="ui">New Project</span> &gt; <span class="ui">
Visual C&#43;&#43;</span> &gt; <span class="ui">Windows Phone</span> &gt; <span class="ui">
Windows Phone Runtime Component</span>. You can create these projects only by using C&#43;&#43; in Windows&nbsp;Phone&nbsp;8.
</p>
</li><li>
<p><span class="label">AudioComponent_Phone.</span> This is a Windows Runtime component written in C&#43;&#43;. The component exposes methods to play and stop a sound. It also has methods to suspend and resume the audio engine, which prevents unnecessary battery
 drain in your app when the sound isn’t needed. </p>
</li></ul>
<p><b>Creating a Windows Runtime component for Windows&nbsp;Phone&nbsp;</b> </p>
<p>The following steps describe how to create a Windows Runtime component and then use it in your phone app. These components often are referred to as third-party Windows Runtime components, to distinguish them from the first-party Windows Runtime APIs that
 you get in the platform. In Windows&nbsp;Phone&nbsp;8 we also refer to them as Windows Phone Runtime components because they are created using a project template specifically designed to use for Windows&nbsp;Phone&nbsp;8 and can only be consumed by Windows&nbsp;Phone&nbsp;8 apps. We’ll
 use these names interchangeably to refer to components written to use in your Windows&nbsp;Phone&nbsp;8 app. Part of the output generated by these projects is a
<span class="term">Windows metadata (.winmd)</span> file, which has the extension .winmd. This file contains the metadata required for all supported languages to consume the functionality you expose in your component.</p>
<p>Remember that Windows&nbsp;Phone&nbsp;8 only supports creating Windows Runtime components in C&#43;&#43;, but can be consumed by phone apps and other Windows Runtime components written in C&#43;&#43;, C#, and Visual Basic. The Visual Studio project template we use to create the Windows
 Phone Runtime component project sets up everything that’s required to create a .winmd file that you can consume in your app. In this example, we’ll assume the phone app that is consuming the component is a XAML app written in C#, but the steps also apply to
 apps written in Visual Basic or C&#43;&#43;.</p>
<ol>
<li>
<p><span class="label">Create a Windows Phone Runtime component project and add it to your solution.</span> Right-click your solution in
<span class="ui">Solution Explorer</span> and then select <span class="ui">Add</span> &gt;
<span class="ui">New Project</span> &gt; <span class="ui">Windows Phone</span> &gt;
<span class="ui">Windows Phone Runtime Component</span>. This creates a new project in your solution. Make sure you select the
<span class="ui">Windows Phone Runtime Component</span> project template from the set of
<span class="ui">Windows Phone</span> templates and not the Windows Runtime Component template from the set of
<span class="ui">Windows Store</span> templates. A Windows Runtime Component template is not compatible with Windows&nbsp;Phone&nbsp;8.
</p>
</li><li>
<p><span class="label">Define the component classes, or API, that you want to expose to your app.</span> You need to define one or more classes to be able to use your new component in your app. Because Windows Runtime components can be consumed by multiple
 languages, the types visible to the consumer of the component are restricted to those that can be published in the .winmd file. For example, types must be declared in a namespace and must be declared as
<span value="public"><span class="keyword">public</span></span>. These classes, or types, must also be declared as a
<span value="ref"><span class="keyword">ref</span></span> class and declared as
<span value="sealed"><span class="keyword">sealed</span></span> because inheritance is not allowed. To learn about the complete type system and limitations on public types your component can expose, see
<a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/hh699871(v=vs.105).aspx">
Visual C&#43;&#43; Language Reference (C&#43;&#43;/CX)</a>.</p>
<p><span class="label">Implement the interface.</span> Although there are restrictions for the types that are visible from your component, you have a lot more freedom in what you use privately inside your component. This way you can use Win32, COM, XAudio2,
 and Direct3D APIs inside the component to implement features and functionality that you want to use in your Windows Phone app. In this sample, we use XAudio2 APIs to play sound. We create a Windows Runtime component that implements a class with methods such
 as <span class="label">PlaySound</span> and <span class="label">StopSound</span>. Inside the component, we call in to the powerful XAudio2 APIs to do the heavy lifting. To use these APIs we need to reference the correct header files and link to xaudio2.lib.
 To call XAudio2 APIs, add <span class="label">xaudio2.lib</span> to the list of
<span class="ui">Additional Dependencies</span> in the <span class="ui">Property Pages</span> dialog of your component’s project, and include xaudio2.h in your pch.h header file. Remember to add the library to the Additional Dependencies for each project
 configuration – <span class="label">Debug, Release</span>, etc.</p>
</li><li>
<p><span class="label">Reference the component from your phone app project.</span> To use your component in your app, you’ll need to add a reference in your phone app project for that component. In
<span class="ui">Solution Explorer</span>, right-click your main project, and then click
<span class="ui">Add Reference</span>. In the <span class="ui">Add Reference</span> dialog, in the left pane click
<span class="ui">Solution</span>. Your new Windows Runtime component now appears in the center pane of the dialog. In the Name column, select the project you want to reference. Click
<span class="ui">OK</span> to finish adding the reference to your project. When you expand the list of references in your project you’ll now see a reference to your component. Build your solution to verify that everything compiles correctly.
</p>
</li><li>
<p><span class="label">Build, test, validate.</span> As you develop your component be sure you regularly build the solution and test the functionality as you proceed. You can also debug your component and step through its logic to make sure works as expected.
 If your phone app is written in C# or Visual Basic, you can still debug the native code of your Windows Runtime component by selecting
<span class="ui">Native Only</span> for the <span class="ui">Debugger Type</span> setting in the
<span class="ui">Debug</span> properties of your Windows Phone app. You can’t debug native code and managed code at the same time, so use this setting to toggle between native and managed code debugging.
</p>
</li></ol>
<p><b>See also</b> </p>
<ul>
<li>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj714080(v=vs.105).aspx">Share using Windows Runtime Components</a>
</p>
</li><li>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/jj206944(v=vs.105).aspx">Native audio APIs for Windows Phone 8</a>
</p>
</li><li>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/hh441572.aspx">Creating Windows Runtime Components</a>
</p>
</li><li>
<p><a href="http://msdn.microsoft.com/en-us/library/windowsphone/develop/hh699871(v=vs.110).aspx">Visual C&#43;&#43; Language Reference (C&#43;&#43;/CX)</a>
</p>
</li></ul>
</div>
</div>

</div>


    </div>
</body>
</html>
